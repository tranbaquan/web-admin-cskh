<div class="main">
  <div class="form">
    <div class="form-group">
      <div class="image-preview">
        <img *ngIf="product.ImagesPath" [src]="getUrl(product)" [alt]="product.NameProduct">
      </div>
      <div class="upload-group">
        <button appIconButton background="bg-orange" (click)="openFileDialog()">
          <fa-icon [icon]="faCameraRetro"></fa-icon>
        </button>
        <input #fileUpload type="file" [hidden]="true" accept="image/*" (change)="onFileSelected($event)">
        <div>Nhập / thay hình sản phẩm</div>
      </div>
    </div>

    <div class="form-group">
      <div class="group-title">Thông tin sản phẩm</div>
      <div class="input">
        <label>Tên sản phẩm</label>
        <input type="text" placeholder="Tên sản phẩm" [required]="true" [(ngModel)]="product.NameProduct" appInput>
      </div>
      <div class="input">
        <label>Loại sản phẩm</label>
        <select id="product-type" [(ngModel)]="product.TypeProductID" appSelect>
          <option *ngFor="let type of productTypes" [value]="type.TypeProductID">{{type.NameType}}</option>
        </select>
      </div>
      <div class="input-group">
        <div class="input">
          <label>Mã sản phẩm</label>
          <input type="text" placeholder="Mã sản phẩm" [required]="true" [(ngModel)]="product.Code" appInput>
        </div>
        <div class="input">
          <label>Hãng sản xuất</label>
          <select id="producers" placeholder="Hãng sản xuất" [(ngModel)]="product.ListProduction[0]" appSelect>
            <option *ngFor="let producer of producers" [value]="producer.ProductionID">{{producer.NameProduction}}</option>
          </select>
        </div>
      </div>
      <div class="input-group">
        <div class="input weight">
          <label>Khối lượng tối thiểu</label>
          <select id="weight" appSelect [(ngModel)]="product.MinQuantity">
            <option [value]="product.MinQuantity">{{product.MinQuantity}}</option>
          </select>
        </div>
        <div class="input">
          <label>Đơn vị</label>
          <select id="unit" appSelect [(ngModel)]="product.Unit">
            <option [value]="product.Unit">{{product.Unit}}</option>
          </select>
        </div>
      </div>
      <div class="input-group">
        <div class="input checkbox">
          <label>Trạng thái</label>
          <input type="checkbox" appInput [(ngModel)]="product.Status">
        </div>

        <div class="input checkbox">
          <label>FIFO</label>
          <input type="checkbox" appInput [(ngModel)]="product.FIFO">
        </div>
      </div>
      <div class="input-group">
        <div class="input checkbox">
          <label>isHome</label>
          <input type="checkbox" appInput [(ngModel)]="product.IsHome">
        </div>

        <div class="input checkbox">
          <label>isStandard</label>
          <input type="checkbox" appInput [(ngModel)]="product.IsStandard">
        </div>
      </div>
      <div class="input-group">
        <div class="input checkbox">
          <label>isBestSell</label>
          <input type="checkbox" appInput [(ngModel)]="product.IsBestSell">
        </div>

        <div class="input checkbox">
          <label>isSpecial</label>
          <input type="checkbox" appInput [(ngModel)]="product.IsSpecical">
        </div>
      </div>
    </div>
    <div class="form-group">
      <div class="group-title">Đặc tả sản phẩm</div>
      <ng-container *ngIf="product.ListSpec1.length != 0">
        <div class="input">
          <label>Tên đặc tả</label>
          <input type="text" appInput [(ngModel)]="product.ListSpec1[0].SpecName">
        </div>
        <div class="input">
          <label>Giá trị</label>
          <div class="input-list">
            <ng-container *ngFor="let spec of product.ListSpec1; index as index">
              <div class="spec-item" (click)="openModal('edit-spec-item-modal')" *ngIf="index != 0">
                {{spec.SpecName}}
              </div>
<!--              <input *ngIf="index != 0" type="text" appInput [width]="70" [value]="spec.SpecName">-->
            </ng-container>
            <button appIconButton background="bg-orange">
              <fa-icon [icon]="faPlus"></fa-icon>
            </button>
          </div>
        </div>
      </ng-container>
      <ng-container *ngIf="product.ListSpec2.length != 0">
        <div class="input">
          <label>Tên đặc tả</label>
          <input type="text" appInput [(ngModel)]="product.ListSpec2[0].SpecName">
        </div>
        <div class="input">
          <label>Giá trị</label>
          <div class="input-list">
            <ng-container *ngFor="let spec of product.ListSpec2; index as index">
              <div class="spec-item"  (click)="openModal('edit-spec-item-modal')" *ngIf="index != 0">
                {{spec.SpecName}}
              </div>
<!--              <input *ngIf="index != 0" type="text" appInput [width]="70" [value]="spec.SpecName">-->
            </ng-container>
            <button appIconButton background="bg-orange">
              <fa-icon [icon]="faPlus"></fa-icon>
            </button>
          </div>
        </div>
      </ng-container>
      <ng-container *ngIf="product.ListSpec3.length != 0">
        <div class="input">
          <label>Tên đặc tả</label>
          <input type="text" appInput [(ngModel)]="product.ListSpec3[0].SpecName">
        </div>
        <div class="input">
          <label>Giá trị</label>
          <div class="input-list">
            <ng-container *ngFor="let spec of product.ListSpec3; index as index">
              <div class="spec-item" (click)="openModal('edit-spec-item-modal')" *ngIf="index != 0">
                {{spec.SpecName}}
              </div>
<!--              <input *ngIf="index != 0" type="text" appInput [width]="70" [value]="spec.SpecName">-->
            </ng-container>
            <button appIconButton background="bg-orange">
              <fa-icon [icon]="faPlus"></fa-icon>
            </button>
          </div>
        </div>
      </ng-container>
      <div *ngIf="product.ListSpec3 || product.ListSpec3.length === 0">
        <button appButton background="bg-dark" (click)="openModal('add-spec-modal')">
          <fa-icon [icon]="faPlus"></fa-icon>
          <label>Thêm đặc tả</label>
        </button>
      </div>
    </div>
    <div class="form-group">
      <div class="group-title">Giá và chiết khấu</div>
      <div class="input-group">
        <div class="input">
          <label>Giá</label>
          <input type="number" [min]="0" appInput [(ngModel)]="product.AmountSale">
        </div>
        <div class="input">
          <label>Chiết khấu</label>
          <input type="number" [min]="0" appInput [(ngModel)]="product.DiscountProvider">
        </div>
      </div>
    </div>
    <div class="form-group">
      <div class="group-title">Mô tả</div>
      <ckeditor [(ngModel)]="product.Description"></ckeditor>
    </div>
    <div class="form-group">
      <div class="group-title">Thông số kỹ thuật</div>
      <ckeditor [(ngModel)]="product.InformationTech"></ckeditor>
    </div>
    <div class="form-group">
      <button background="bg-orange" appButton (click)="saveChange()">Lưu thay đổi</button>
    </div>
  </div>
  <div class="table">
    <table appTable [isEvenSeparate]="true">
      <tr>
        <th>Tên sản phẩm</th>
        <th>Mã sản phẩm</th>
        <th *ngIf="product.ListSpec1.length != 0">{{product.ListSpec1[0]?.SpecName}}</th>
        <th *ngIf="product.ListSpec2.length != 0">{{product.ListSpec2[0]?.SpecName}}</th>
        <th *ngIf="product.ListSpec3.length != 0">{{product.ListSpec3[0]?.SpecName}}</th>
        <th>Đơn vị</th>
        <th>Giá</th>
        <th>Chiết khấu</th>
        <th>Số lượng tối thiểu</th>
      </tr>
      <tr *ngFor="let price of product.ListPrices">
        <td>{{product.NameProduct}}</td>
        <td>{{product.Code}}</td>
        <td *ngIf="product.ListSpec1.length != 0">{{findSpecName(product.ListSpec1, price.SpecID1)}}</td>
        <td *ngIf="product.ListSpec2.length != 0">{{findSpecName(product.ListSpec2, price.SpecID2)}}</td>
        <td *ngIf="product.ListSpec3.length != 0">{{findSpecName(product.ListSpec3, price.SpecID2)}}</td>
        <td>{{product.Unit}}</td>
        <td>{{price.Prices | vnd}}</td>
        <td>{{product.DiscountProvider}}</td>
        <td>{{product.MinQuantity}}</td>
      </tr>
      <tr *ngIf="!product.ListPrices || product.ListPrices.length == 0">
        <td colspan="9" style="text-align: center">Chưa có dữ liệu</td>
      </tr>
    </table>
  </div>
</div>

<app-modal id="add-spec-modal" [width]="500" [contentTemplate]="addSpecModal"></app-modal>
<app-modal id="edit-spec-item-modal" [width]="500" [contentTemplate]="editSpecItemModal"></app-modal>

<ng-template #addSpecModal>
  <app-modal-header>
    <div class="modal-title">
      <div class="title">Thêm đặc tả</div>
    </div>
    <div>
      <button appIconButton background="bg-transparent" (click)="closeModal('add-spec-modal')">
        <fa-icon size="lg" [icon]="faTimesCircle"></fa-icon>
      </button>
    </div>
  </app-modal-header>
  <app-modal-body>
    <form [formGroup]="addSpecFormGroup" class="modal-form">
      <div class="input">
        <label>Mã đặc tả</label>
        <input formControlName="Code" placeholder="Mã đặc tả" type="text" appInput>
      </div>
      <div class="input">
        <label>Tên đặc tả</label>
        <input formControlName="SpecName" placeholder="Tên đặc tả" type="text" appInput>
      </div>
      <div class="input">
        <label>Trạng thái</label>
        <select formControlName="Status" appSelect>
          <option [value]="1">Kích hoạt</option>
          <option [value]="0">Hủy kích hoạt</option>
        </select>
      </div>
    </form>
  </app-modal-body>
  <app-modal-footer>
    <div class="right-section">
      <div class="btn-group">
        <button appButton background="bg-gray" (click)="closeModal('add-spec-modal')">Close</button>
        <button appButton background="bg-orange" (click)="addSpec()">Save</button>
      </div>
    </div>
  </app-modal-footer>
</ng-template>


<ng-template #editSpecItemModal>
  <app-modal-header>
    <div class="modal-title">
      <div class="title">Cập nhật lựa chọn</div>
      <div class="description">Chỉnh sửa thông tin hoặc xóa lựa chọn này</div>
    </div>
    <div>
      <button appIconButton background="bg-transparent" (click)="closeModal('edit-spec-item-modal')">
        <fa-icon size="lg" [icon]="faTimesCircle"></fa-icon>
      </button>
    </div>
  </app-modal-header>
  <app-modal-body>
    <form class="modal-form">
      <div class="input">
        <label>Mã lựa chọn</label>
        <input type="text" appInput>
      </div>
      <div class="input">
        <label>Tên lựa chọn</label>
        <input type="text" appInput>
      </div>
    </form>
  </app-modal-body>
  <app-modal-footer>
    <div class="right-section">
      <div class="btn-group">
        <button appButton background="bg-gray" (click)="closeModal('edit-spec-item-modal')">Close</button>
        <button appButton background="bg-orange">Save</button>
      </div>
    </div>
  </app-modal-footer>
</ng-template>
